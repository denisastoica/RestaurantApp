<Page x:Class="Restaurant.Views.MenuPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:models="clr-namespace:Restaurant.Models"
      xmlns:vm="clr-namespace:Restaurant.ViewModels"
      xmlns:services="clr-namespace:Restaurant.Services"
      Title="Meniu">

    <Page.Resources>
        <services:ImagePathToImageSourceConverter x:Key="ImagePathToImageSourceConverter" />

        <DataTemplate DataType="{x:Type models:Product}">
            <Border CornerRadius="5" BorderBrush="Gray" BorderThickness="1" Padding="5" Margin="5">
                <StackPanel Orientation="Horizontal">
                    <Image Width="80" Height="80" Margin="0,0,10,0"
                   Source="{Binding ProductPhotos[0].PhotoUrl, Converter={StaticResource ImagePathToImageSourceConverter}}" />
                    <StackPanel>
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text="{Binding Price, StringFormat='{}{0:F2} RON'}" FontSize="13"/>
                        <TextBlock>
        <Run Text="Stoc restaurant: " FontWeight="SemiBold"/>
        <Run Text="{Binding TotalQuantity, StringFormat='{}{0:0}'}"/>
                        </TextBlock>
                        <TextBlock Text="{Binding PortionSize}" FontStyle="Italic" FontSize="12"/>
                        <TextBlock Text="{Binding AllergensText}" FontStyle="Italic" Foreground="DarkOrange" FontSize="12"/>
                        <TextBlock Text="{Binding AvailabilityText}" Foreground="Red" FontWeight="Bold" FontSize="14"/>

                    </StackPanel>

                    <Button Content="Adaugă în coș"
                Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                CommandParameter="{Binding}"
                IsEnabled="{Binding IsAvailable}"
                Margin="10,0,0,0"
                VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:MenuDisplayItem}">
            <Border CornerRadius="5" BorderBrush="DarkBlue" BorderThickness="1" Padding="5" Margin="5">
                <StackPanel>
                    <Image Width="150" Height="100" Stretch="Uniform"
                           Source="{Binding PhotoUrl, Converter={StaticResource ImagePathToImageSourceConverter}}" />
                    <TextBlock Text="{Binding Menu.Name}" FontWeight="Bold" Foreground="DarkBlue" FontSize="16" Margin="0,5,0,0"/>
                    <TextBlock Text="{Binding Menu.MenuItems.Count, StringFormat='Items: {0}'}" FontSize="13" Margin="0,2,0,0"/>
                    <TextBlock Text="{Binding CalculatedPrice, StringFormat='{}{0:F2} lei'}" FontWeight="Bold" Foreground="DarkGreen" FontSize="14" Margin="0,5,0,0"/>

                    <ItemsControl ItemsSource="{Binding ItemsWithQuantities}" Margin="0,10,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock FontSize="12">
  <Run Text="{Binding ProductName}" FontWeight="SemiBold"/>
  <Run Text=" - Cantitate în meniu: " />
  <Run Text="{Binding QuantityInMenu}" />
  <Run Text=" " />
  <Run Text="{Binding Unit, Mode=OneWay}" />
  <Run Text=" (porție standard: " />
  <Run Text="{Binding PortionSize}" />
  <Run Text=")" />
                                </TextBlock>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Button Content="Adaugă în coș"
                    Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                    CommandParameter="{Binding}"
                    IsEnabled="{Binding IsAvailable}"
                    Margin="5,10,0,0"
                    HorizontalAlignment="Left"/>
                </StackPanel>
            </Border>
        </DataTemplate>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <ComboBox Grid.Row="0"
                  ItemsSource="{Binding Categories}"
                  SelectedItem="{Binding SelectedCategory}"
                  DisplayMemberPath="Name"
                  Width="200" Margin="10"/>

        <ListView Grid.Row="1"
                  ItemsSource="{Binding Items}"
                  Margin="10"/>
    </Grid>
</Page>